<?php
/*
Plugin Name: project one plugin
Plugin URI: http://localhost
Description: description
Version: 0.1.0038
Author: ohO_oho
Author URI: http://localhost
License: GPL2
*/

/*  Copyright 2011  ohO_oho  (email: paul.bs@gmail.com) */

//album-283_92418231#offset=40&part=1
//"/album-283_92418231#offset=40&part=1"
//"/al_photos.php#act=show&list=album-283_92418231&photo=-283_127988404"
//"5389<!>photoview.css,photoview.js<!>0<!>4681<!>0<!>album-283_92418231<!><!int>334<!><!int>333<!><!json>[{"id":"-283_269408149","x_src":"http:\/\/cs4172.vkontakte.ru\/u249650\/92418231\/x_382b8465.jpg","y_src":"http:\/\/cs4172.vkontakte.ru\/u249650\/92418231\/y_f4598f85.jpg","z_src":"http:\/\/cs4172.vkontakte.ru\/u249650\/92418231\/z_eb850bf0.jpg","commcount":"0","commshown":0,"comments":"","date":"10 октября 2011","tags":[0],"tagged":[],"album":"<a href=\"album-283_92418231\" onclick=\"return nav.go(this, event)\">гитары с одним датчиком<\/a>","author":"<a class=\"mem_link\" href=\"\/id249650\" onclick=\"return nav.go(this, event)\">Александр Александрович<\/a>","likes":0,"actions":{"spam":1,"comm":1,"save":1},"desc":"Peavey Nitro-1","hash":"c76b65e3db947467cd"},{"id":"-283_127988168","x_src":"http:\/\/cs1536.vkontakte.ru\/u249650\/92418231\/x_481d972d.jpg","commcount":"31","commshown":3,"comments":"<div class=\"clear_fix pv_comment \" id=\"pv_comment-283_97503231\"><div>\n  <div class=\"fl_l pv_thumb\">\n    <a href=\"\/id9716814\" onclick=\"return nav.go(this, event)\"><img src=\"http:\/\/cs9240.vkontakte.ru\/u9716814\/e_e3e745e6.jpg\" \/><\/a>\n  <\/div>\n  <div class=\"fl_l pv_comm\">\n    <a href=\"\/id9716814\" onclick=\"return nav.go(this, event)\" class=\"name\">Арсений Иосипов<\/a>\n    <div class=\"pv_commtext\">Второй по счету &quot;недорогой стратик&quot; просто невероятно возбудил.)<br>А вот от дельксовых как раз (можете пинать)не в особом восторге.<\/div>\n    <div class=\"pv_commdata\">\n      <span class=\"fl_l\">14 мар 2010 в 11:46<span class=\"sdivide\">|<\/span><a onclick=\"photoview.commAction('spam', '-283_97503231', '38c364ab22503a2c5c')\">это спам<\/a><\/span>\n      <div class=\"fl_r progress\" id=\"pv_progress-283_97503231\"><\/div>\n    <\/div>\n  <\/div>\n  \n<\/div><\/div><div class=\"clear_fix pv_comment \" id=\"pv_comment-283_98151353\"><div>\n  <div class=\"fl_l pv_thumb\">\n    <a href=\"\/unit_731\" onclick=\"return nav.go(this, event)\"><img src=\"http:\/\/cs9503.vkontakte.ru\/u36475310\/e_3e78e0d3.jpg\" \/><\/a>\n  <\/div>\n  <div class=\"fl_l pv_comm\">\n    <a href=\"\/unit_731\" onclick=\"return nav.go(this, event)\" class=\"name\">Паша Галкин<\/a>\n    <div class=\"pv_commtext\">Александр Александрович<br><br>объяснить не мог<\/div>\n    <div class=\"pv_commdata\">\n      <span class=\"fl_l\">13 мая 2010 в 18:00<span class=\"sdivide\">|<\/span><a onclick=\"photoview.commAction('spam', '-283_98151353', '70685d897344d3a729')\">это спам<\/a><\/span>\n      <div class=\"fl_r progress\" id=\"pv_progress-283_98151353\"><\/div>\n    <\/div>\n  <\/div>\n  \n<\/div><\/div><div class=\"clear_fix pv_comment \" id=\"pv_comment-283_98394332\"><div>\n  <div class=\"fl_l pv_thumb\">\n    <a href=\"\/id38179084\" onclick=\"return nav.go(this, event)\"><img src=\"http:\/\/cs10177.vkontakte.ru\/u38179084\/e_45a435ad.jpg\" \/><\/a>\n  <\/div>\n  <div class=\"fl_l pv_comm\">\n    <a href=\"\/id38179084\" onclick=\"return nav.go(this, event)\" class=\"name\">Саша Найдён<\/a>\n    <div class=\"pv_commtext\">борланд охуенен, всем слушать первый альбом бизкитов..., охуенен во многом....<\/div>\n    <div class=\"pv_commdata\">\n      <span class=\"fl_l\">5 июн 2010 в 2:28<span class=\"sdivide\">|<\/span><a onclick=\"photoview.commAction('spam', '-283_98394332', '70b42eb4619ad37094')\">это спам<\/a><\/span>\n      <div class=\"fl_r progress\" id=\"pv_progress-283_98394332\"><\/div>\n    <\/div>\n  <\/div>\n  \n<\/div><\/div>","date":"26 апреля 2009","tags":{"11700837":[30.28,2.29,60.83,99.58],"0":1},"tagged":{"17370852":"11700837"},"tagshtml":"<span id=\"pv_tag11700837\" onmouseover=\"photoview.showTag(11700837)\" onmouseout=\"photoview.hideTag()\"><span><a href=\"\/id17370852\" onclick=\"return nav.go(this, event)\">Ibanez Deluxe<\/a><\/span><\/span>","album":"<a href=\"album-283_92418231\" onclick=\"return nav.go(this, event)\">гитары с одним датчиком<\/a>","author":"<a class=\"mem_link\" href=\"\/id249650\" onclick=\"return nav.go(this, event)\">Александр Александрович<\/a>","likes":2,"actions":{"spam":1,"comm":1,"save":1},"desc":"Ibanez Roadstar deluxe","hash":"4bf46025208fe5d73d"},{"id":"-283_127988195","x_src":"http:\/\/cs1536.vkontakte.ru\/u249650\/92418231\/x_544eeb44.jpg","commcount":"6","commshown":6,"comments":"<div class=\"clear_fix pv_comment \" id=\"pv_comment-283_94531446\"><div>\n  <div class=\"fl_l pv_thumb\">\n    <a href=\"\/drygva\" onclick=\"return nav.go(this, event)\"><img src=\"http:\/\/cs5963.vkontakte.ru\/u7760832\/e_8e53712a.jpg\" \/><\/a>\n  <\/div>\n  <div class=\"fl_l pv_comm\">\n    <a href=\"\/drygva\" onclick=\"return nav.go(this, event)\" class=\"name\">Алексей Стецюк<\/a>\n    <div class=\"pv_commtext\">бля прикольно)<\/div>\n    <div class=\"pv_commdata\">\n      <span class=\"fl_l\">27 апр 2009 в 20:56<span class=\"sdivide\">|<\/span><a onclick=\"photoview.commAction('spam', '-283_94531446', 'b0731a9532f74825db')\">это спам<\/a><\/span>\n      <div class=\"fl_r progress\" id=\"pv_progress-283_94531446\"><\/div>\n    <\/div>\n  <\/div>\n  \n<\/div><\/div><div class=\"clear_fix pv_comment \" id=\"pv_comment-283_94794041\"><div>\n  <div class=\"fl_l pv_thumb\">\n    <a href=\"\/saga86\" onclick=\"return nav.go(this, event)\"><img src=\"http:\/\/cs4539.vkontakte.ru\/u5771117\/e_39a45039.jpg\" \/><\/a>\n  <\/div>\n  <div class=\"fl_l pv_comm\">\n    <a href=\"\/saga86\" onclick=\"return nav.go(this, event)\" class=\"name\">Алексей Гавриленко<\/a>\n    <div class=\"pv_commtext\">выглядит супер&#33; только блин, что то спама много стало в последнее время писаться...<\/div>\n    <div class=\"pv_commdata\">\n      <span class=\"fl_l\">1 июн 2009 в 21:16<span class=\"sdivide\">|<\/span><a onclick=\"photoview.commAction('spam', '-283_94794041', '296c93649b5f5742b0')\">это спам<\/a><\/span>\n      <div class=\"fl_r progress\" id=\"pv_progress-283_94794041\"><\/div>\n    <\/div>\n  <\/div>\n  \n<\/div><\/div><div class=\"clear_fix pv_comment \" id=\"pv_comment-283_94945179\"><div>\n  <div class=\"fl_l pv_thumb\">\n    <a href=\"\/id21730464\" onclick=\"return nav.go(this, event)\"><img src=\"http:\/\/vkontakte.ru\/images\/deactivated_c.gif\" \/><\/a>\n  <\/div>\n  <div class=\"fl_l pv_comm\">\n    <a href=\"\/id21730464\" onclick=\"return nav.go(this, event)\" class=\"name\">Роман Рабуцький<\/a>\n    <div class=\"pv_commtext\">жир<\/div>\n    <div class=\"pv_commdata\">\n      <span class=\"fl_l\">21 июн 2009 в 16:49<span class=\"sdivide\">|<\/span><a onclick=\"photoview.commAction('spam', '-283_94945179', '7cee06a7de3754b817')\">это спам<\/a><\/span>\n      <div class=\"fl_r progress\" id=\"pv_progress-283_94945179\"><\/div>\n    <\/div>\n  <\/div>\n  \n<\/div><\/div><div class=\"clear_fix pv_comment \" id=\"pv_comment-283_95927300\"><div>\n  <div class=\"fl_l pv_thumb\">\n    <a href=\"\/arnakjan\" onclick=\"return nav.go(this, event)\"><img src=\"http:\/\/vkontakte.ru\/images\/question_c.gif\" \/><\/a>\n  <\/div>\n  <div class=\"fl_l pv_comm\">\n    <a href=\"\/arnakjan\" onclick=\"return nav.go(this, event)\" class=\"name\">Арнак Енокян<\/a>\n    <div class=\"pv_commtext\">ооо шелби джи ти хочу такуюююю<\/div>\n    <div class=\"pv_commdata\">\n      <span class=\"fl_l\">23 окт 2009 в 19:43<span class=\"sdivide\">|<\/span><a onclick=\"photoview.commAction('spam', '-283_95927300', '9c9c8eb36b309d3885')\">это спам<\/a><\/span>\n      <div class=\"fl_r progress\" id=\"pv_progress-283_95927300\"><\/div>\n    <\/div>\n  <\/div>\n  \n<\/div><\/div><div class=\"clear_fix pv_comment \" id=\"pv_comment-283_96606207\"><div>\n  <div class=\"fl_l pv_thumb\">\n    <a href=\"\/id6407618\" onclick=\"return nav.go(this, event)\"><img src=\"http:\/\/cs4303.vkontakte.ru\/u6407618\/e_70e24cb2.jpg\" \/><\/a>\n  <\/div>\n  <div class=\"fl_l pv_comm\">\n    <a href=\"\/id6407618\" onclick=\"return nav.go(this, event)\" class=\"name\">Олег Сапожников<\/a>\n    <div class=\"pv_commtext\">правильная палка<\/div>\n    <div class=\"pv_commdata\">\n      <span class=\"fl_l\">28 дек 2009 в 19:00<span class=\"sdivide\">|<\/span><a onclick=\"photoview.commAction('spam', '-283_96606207', 'c8a56414c13cc3466e')\">это спам<\/a><\/span>\n      <div class=\"fl_r progress\" id=\"pv_progress-283_96606207\"><\/div>\n    <\/div>\n  <\/div>\n  \n<\/div><\/div><div class=\"clear_fix pv_comment \" id=\"pv_comment-283_102467886\"><div>\n  <div class=\"fl_l pv_thumb\">\n    <a href=\"\/id25074685\" onclick=\"return nav.go(this, event)\"><img src=\"http:\/\/cs9646.vkontakte.ru\/u25074685\/e_5c9ab16b.jpg\" \/><\/a>\n  <\/div>\n  <div class=\"fl_l pv_comm\">\n    <a href=\"\/id25074685\" onclick=\"return nav.go(this, event)\" class=\"name\">Александр Гришин<\/a>\n    <div class=\"pv_commtext\">Трататастер111<\/div>\n    <div class=\"pv_commdata\">\n      <span class=\"fl_l\">6 мая 2011 в 15:51<span class=\"sdivide\">|<\/span><a onclick=\"photoview.commAction('spam', '-283_102467886', '496636348aa9dbed28')\">это спам<\/a><\/span>\n      <div class=\"fl_r progress\" id=\"pv_progress-283_102467886\"><\/div>\n    <\/div>\n  <\/div>\n  \n<\/div><\/div>","date":"26 апреля 2009","tags":[0],"tagged":[],"album":"<a href=\"album-283_92418231\" onclick=\"return nav.go(this, event)\">гитары с одним датчиком<\/a>","author":"<a class=\"mem_link\" href=\"\/id249650\" onclick=\"return nav.go(this, event)\">Александр Александрович<\/a>","likes":0,"actions":{"spam":1,"comm":1,"save":1},"desc":"Fender GT","hash":"e3ca92bcbb13da425a"},{"id":"-283_127988404","x_src":"http:\/\/cs1536.vkontakte.ru\/u249650\/92418231\/x_f9f650f8.jpg","commcount":"23","commshown":3,"comments":"<div class=\"clear_fix pv_comment \" id=\"pv_comment-283_98453401\"><div>\n  <div class=\"fl_l pv_thumb\">\n    <a href=\"\/maxscotch\" onclick=\"return nav.go(this, event)\"><img src=\"http:\/\/cs10547.vkontakte.ru\/u18429047\/e_7c7e00c7.jpg\" \/><\/a>\n  <\/div>\n  <div class=\"fl_l pv_comm\">\n    <a href=\"\/maxscotch\" onclick=\"return nav.go(this, event)\" class=\"name\">Max Scotch<\/a>\n    <div class=\"pv_commtext\">для своей цены гитара просто шик. демку может позже кину)<\/div>\n    <div class=\"pv_commdata\">\n      <span class=\"fl_l\">11 июн 2010 в 8:08<span class=\"sdivide\">|<\/span><a onclick=\"photoview.commAction('spam', '-283_98453401', 'b5c23c07d65aa4d89b')\">это спам<\/a><\/span>\n      <div class=\"fl_r progress\" id=\"pv_progress-283_98453401\"><\/div>\n    <\/div>\n  <\/div>\n  \n<\/div><\/div><div class=\"clear_fix pv_comment \" id=\"pv_comment-283_98458046\"><div>\n  <div class=\"fl_l pv_thumb\">\n    <a href=\"\/alexsnake1\" onclick=\"return nav.go(this, event)\"><img src=\"http:\/\/cs4937.vkontakte.ru\/u17150925\/e_113b23dd.jpg\" \/><\/a>\n  <\/div>\n  <div class=\"fl_l pv_comm\">\n    <a href=\"\/alexsnake1\" onclick=\"return nav.go(this, event)\" class=\"name\">Алексей Журавлёв<\/a>\n    <div class=\"pv_commtext\">Ждём демку)<\/div>\n    <div class=\"pv_commdata\">\n      <span class=\"fl_l\">11 июн 2010 в 18:22<span class=\"sdivide\">|<\/span><a onclick=\"photoview.commAction('spam', '-283_98458046', '11afaf11fcfe861951')\">это спам<\/a><\/span>\n      <div class=\"fl_r progress\" id=\"pv_progress-283_98458046\"><\/div>\n    <\/div>\n  <\/div>\n  \n<\/div><\/div><div class=\"clear_fix pv_comment \" id=\"pv_comment-283_99393944\"><div>\n  <div class=\"fl_l pv_thumb\">\n    <a href=\"\/rock.n.blues\" onclick=\"return nav.go(this, event)\"><img src=\"http:\/\/cs5456.vkontakte.ru\/u9799067\/e_f9661dfd.jpg\" \/><\/a>\n  <\/div>\n  <div class=\"fl_l pv_comm\">\n    <a href=\"\/rock.n.blues\" onclick=\"return nav.go(this, event)\" class=\"name\">Миша Тентлер<\/a>\n    <div class=\"pv_commtext\">Одна из самых нормальных расцветок телека.<\/div>\n    <div class=\"pv_commdata\">\n      <span class=\"fl_l\">12 сен 2010 в 22:14<span class=\"sdivide\">|<\/span><a onclick=\"photoview.commAction('spam', '-283_99393944', '9b03f4c8acff02215d')\">это спам<\/a><\/span>\n      <div class=\"fl_r progress\" id=\"pv_progress-283_99393944\"><\/div>\n    <\/div>\n  <\/div>\n  \n<\/div><\/div>","date":"26 апреля 2009","tags":[0],"tagged":[],"album":"<a href=\"album-283_92418231\" onclick=\"return nav.go(this, event)\">гитары с одним датчиком<\/a>","author":"<a class=\"mem_link\" href=\"\/id249650\" onclick=\"return nav.go(this, event)\">Александр Александрович<\/a>","likes":1,"actions":{"spam":1,"comm":1,"save":1},"hash":"94c3c6af8efc367766"},{"id":"-283_127989602","x_src":"http:\/\/cs1536.vkontakte.ru\/u249650\/92418231\/x_464f633e.jpg","commcount":"4","commshown":4,"comments":"<div class=\"clear_fix pv_comment \" id=\"pv_comment-283_95239801\"><div>\n  <div class=\"fl_l pv_thumb\">\n    <a href=\"\/id5467782\" onclick=\"return nav.go(this, event)\"><img src=\"http:\/\/cs9257.vkontakte.ru\/u5467782\/e_2a162ab1.jpg\" \/><\/a>\n  <\/div>\n  <div class=\"fl_l pv_comm\">\n    <a href=\"\/id5467782\" onclick=\"return nav.go(this, event)\" class=\"name\">Danil Levin<\/a>\n    <div class=\"pv_commtext\">Эх, а вот эту гитару очень хотелось бы послушать, заинтересовла ;)<\/div>\n    <div class=\"pv_commdata\">\n      <span class=\"fl_l\">3 авг 2009 в 15:06<span class=\"sdivide\">|<\/span><a onclick=\"photoview.commAction('spam', '-283_95239801', '2060dbede7b1ab1105')\">это спам<\/a><\/span>\n      <div class=\"fl_r progress\" id=\"pv_progress-283_95239801\"><\/div>\n    <\/div>\n  <\/div>\n  \n<\/div><\/div><div class=\"clear_fix pv_comment \" id=\"pv_comment-283_103280644\"><div>\n  <div class=\"fl_l pv_thumb\">\n    <a href=\"\/id16751830\" onclick=\"return nav.go(this, event)\"><img src=\"http:\/\/cs4735.vkontakte.ru\/u16751830\/e_3f79b874.jpg\" \/><\/a>\n  <\/div>\n  <div class=\"fl_l pv_comm\">\n    <a href=\"\/id16751830\" onclick=\"return nav.go(this, event)\" class=\"name\">Сергей Индеец<\/a>\n    <div class=\"pv_commtext\">звук у инструмента чумовой..<\/div>\n    <div class=\"pv_commdata\">\n      <span class=\"fl_l\">10 июл 2011 в 8:14<span class=\"sdivide\">|<\/span><a onclick=\"photoview.commAction('spam', '-283_103280644', 'a8d1f4fad1175daaea')\">это спам<\/a><\/span>\n      <div class=\"fl_r progress\" id=\"pv_progress-283_103280644\"><\/div>\n    <\/div>\n  <\/div>\n  \n<\/div><\/div><div class=\"clear_fix pv_comment \" id=\"pv_comment-283_104055485\"><div>\n  <div class=\"fl_l pv_thumb\">\n    <a href=\"\/gromt\" onclick=\"return nav.go(this, event)\"><img src=\"http:\/\/cs9824.vkontakte.ru\/u5809256\/e_570c6098.jpg\" \/><\/a>\n  <\/div>\n  <div class=\"fl_l pv_comm\">\n    <a href=\"\/gromt\" onclick=\"return nav.go(this, event)\" class=\"name\">Дмитрий Ермоленко<\/a>\n    <div class=\"pv_commtext\">есть у меня такая. рабочая лошадь.<\/div>\n    <div class=\"pv_commdata\">\n      <span class=\"fl_l\">13 сен 2011 в 19:08<span class=\"sdivide\">|<\/span><a onclick=\"photoview.commAction('spam', '-283_104055485', 'e01887ec6f8f9caa8a')\">это спам<\/a><\/span>\n      <div class=\"fl_r progress\" id=\"pv_progress-283_104055485\"><\/div>\n    <\/div>\n  <\/div>\n  \n<\/div><\/div><div class=\"clear_fix pv_comment \" id=\"pv_comment-283_104077099\"><div>\n  <div class=\"fl_l pv_thumb\">\n    <a href=\"\/id16751830\" onclick=\"return nav.go(this, event)\"><img src=\"http:\/\/cs4735.vkontakte.ru\/u16751830\/e_3f79b874.jpg\" \/><\/a>\n  <\/div>\n  <div class=\"fl_l pv_comm\">\n    <a href=\"\/id16751830\" onclick=\"return nav.go(this, event)\" class=\"name\">Сергей Индеец<\/a>\n    <div class=\"pv_commtext\">была.. ))<\/div>\n    <div class=\"pv_commdata\">\n      <span class=\"fl_l\">15 сен 2011 в 16:44<span class=\"sdivide\">|<\/span><a onclick=\"photoview.commAction('spam', '-283_104077099', '458d53751e7b1ded8d')\">это спам<\/a><\/span>\n      <div class=\"fl_r progress\" id=\"pv_progress-283_104077099\"><\/div>\n    <\/div>\n  <\/div>\n  \n<\/div><\/div>","date":"26 апреля 2009","tags":[0],"tagged":[],"album":"<a href=\"album-283_92418231\" onclick=\"return nav.go(this, event)\">гитары с одним датчиком<\/a>","author":"<a class=\"mem_link\" href=\"\/id249650\" onclick=\"return nav.go(this, event)\">Александр Александрович<\/a>","likes":0,"actions":{"spam":1,"comm":1,"save":1},"hash":"3759aa209e467792d8"},{"id":"-283_128137689","x_src":"http:\/\/cs1536.vkontakte.ru\/u249650\/92418231\/x_b4741c94.jpg","commcount":"19","commshown":3,"comments":"<div class=\"clear_fix pv_comment \" id=\"pv_comment-283_99225696\"><div>\n  <div class=\"fl_l pv_thumb\">\n    <a href=\"\/v.gusakov\" onclick=\"return nav.go(this, event)\"><img src=\"http:\/\/cs4448.vkontakte.ru\/u70476821\/e_41ec273b.jpg\" \/><\/a>\n  <\/div>\n  <div class=\"fl_l pv_comm\">\n    <a href=\"\/v.gusakov\" onclick=\"return nav.go(this, event)\" class=\"name\">Vyacheslav Gusakov<\/a>\n    <div class=\"pv_commtext\">Евгений Кондратьев <br>ты тупарь убогий<br>у меня такая палка, это высшая гитара<br><\/div>\n    <div class=\"pv_commdata\">\n      <span class=\"fl_l\">29 авг 2010 в 8:34<span class=\"sdivide\">|<\/span><a onclick=\"photoview.commAction('spam', '-283_99225696', 'c054bc0d38b671d9a6')\">это спам<\/a><\/span>\n      <div class=\"fl_r progress\" id=\"pv_progress-283_99225696\"><\/div>\n    <\/div>\n  <\/div>\n  \n<\/div><\/div><div class=\"clear_fix pv_comment \" id=\"pv_comment-283_100766229\"><div>\n  <div class=\"fl_l pv_thumb\">\n    <a href=\"\/igorek182\" onclick=\"return nav.go(this, event)\"><img src=\"http:\/\/cs10121.vkontakte.ru\/u66705183\/e_1568b3f8.jpg\" \/><\/a>\n  <\/div>\n  <div class=\"fl_l pv_comm\">\n    <a href=\"\/igorek182\" onclick=\"return nav.go(this, event)\" class=\"name\">Игорёк Делонг<\/a>\n    <div class=\"pv_commtext\">Иван ты говно, а гитара нет) Уверен ты даже не держал её в руках ни разу.<\/div>\n    <div class=\"pv_commdata\">\n      <span class=\"fl_l\">2 янв 2011 в 16:57<span class=\"sdivide\">|<\/span><a onclick=\"photoview.commAction('spam', '-283_100766229', 'e7d0465d99fafed7b3')\">это спам<\/a><\/span>\n      <div class=\"fl_r progress\" id=\"pv_progress-283_100766229\"><\/div>\n    <\/div>\n  <\/div>\n  \n<\/div><\/div><div class=\"clear_fix pv_comment \" id=\"pv_comment-283_100767969\"><div>\n  <div class=\"fl_l pv_thumb\">\n    <a href=\"\/alexsnake1\" onclick=\"return nav.go(this, event)\"><img src=\"http:\/\/cs4937.vkontakte.ru\/u17150925\/e_113b23dd.jpg\" \/><\/a>\n  <\/div>\n  <div class=\"fl_l pv_comm\">\n    <a href=\"\/alexsnake1\" onclick=\"return nav.go(this, event)\" class=\"name\">Алексей Журавлёв<\/a>\n    <div class=\"pv_commtext\">Хорошая гитарка) Но мне другие страты больше нравятся)<\/div>\n    <div class=\"pv_commdata\">\n      <span class=\"fl_l\">2 янв 2011 в 18:47<span class=\"sdivide\">|<\/span><a onclick=\"photoview.commAction('spam', '-283_100767969', 'eabf0a9e72514d042f')\">это спам<\/a><\/span>\n      <div class=\"fl_r progress\" id=\"pv_progress-283_100767969\"><\/div>\n    <\/div>\n  <\/div>\n  \n<\/div><\/div>","date":"27 апреля 2009","tags":[0],"tagged":[],"album":"<a href=\"album-283_92418231\" onclick=\"return nav.go(this, event)\">гитары с одним датчиком<\/a>","author":"<a class=\"mem_link\" href=\"\/id249650\" onclick=\"return nav.go(this, event)\">Александр Александрович<\/a>","likes":0,"actions":{"spam":1,"comm":1,"save":1},"desc":"Fender - Tom Delonge (blink182)","hash":"4d1b4e11c1366a66a1"},{"id":"-283_128137691","x_src":"http:\/\/cs1536.vkontakte.ru\/u249650\/92418231\/x_f2ad101f.jpg","commcount":"17","commshown":3,"comments":"<div class=\"clear_fix pv_comment \" id=\"pv_comment-283_96319845\"><div>\n  <div class=\"fl_l pv_thumb\">\n    <a href=\"\/id249650\" onclick=\"return nav.go(this, event)\"><img src=\"http:\/\/cs4172.vkontakte.ru\/u249650\/e_ed427a27.jpg\" \/><\/a>\n  <\/div>\n  <div class=\"fl_l pv_comm\">\n    <a href=\"\/id249650\" onclick=\"return nav.go(this, event)\" class=\"name\">Александр Александрович<\/a>\n    <div class=\"pv_commtext\">тому что сам вовремя неуспел повыебывацца<\/div>\n    <div class=\"pv_commdata\">\n      <span class=\"fl_l\">30 ноя 2009 в 21:43<\/span>\n      <div class=\"fl_r progress\" id=\"pv_progress-283_96319845\"><\/div>\n    <\/div>\n  <\/div>\n  \n<\/div><\/div><div class=\"clear_fix pv_comment \" id=\"pv_comment-283_96320081\"><div>\n  <div class=\"fl_l pv_thumb\">\n    <a href=\"\/dudefromalabama\" onclick=\"return nav.go(this, event)\"><img src=\"http:\/\/cs965.vkontakte.ru\/u1723462\/e_e2b6fd39.jpg\" \/><\/a>\n  <\/div>\n  <div class=\"fl_l pv_comm\">\n    <a href=\"\/dudefromalabama\" onclick=\"return nav.go(this, event)\" class=\"name\">Михаил Ногин<\/a>\n    <div class=\"pv_commtext\">если тебе это повод для зависти то мне тя жаль, мэн)<\/div>\n    <div class=\"pv_commdata\">\n      <span class=\"fl_l\">30 ноя 2009 в 22:02<span class=\"sdivide\">|<\/span><a onclick=\"photoview.commAction('spam', '-283_96320081', 'da6ad33f007866b320')\">это спам<\/a><\/span>\n      <div class=\"fl_r progress\" id=\"pv_progress-283_96320081\"><\/div>\n    <\/div>\n  <\/div>\n  \n<\/div><\/div><div class=\"clear_fix pv_comment \" id=\"pv_comment-283_96322796\"><div>\n  <div class=\"fl_l pv_thumb\">\n    <a href=\"\/id249650\" onclick=\"return nav.go(this, event)\"><img src=\"http:\/\/cs4172.vkontakte.ru\/u249650\/e_ed427a27.jpg\" \/><\/a>\n  <\/div>\n  <div class=\"fl_l pv_comm\">\n    <a href=\"\/id249650\" onclick=\"return nav.go(this, event)\" class=\"name\">Александр Александрович<\/a>\n    <div class=\"pv_commtext\">ну да , спустя полгода кулаками не машуть )))<\/div>\n    <div class=\"pv_commdata\">\n      <span class=\"fl_l\">1 дек 2009 в 12:13<\/span>\n      <div class=\"fl_r progress\" id=\"pv_progress-283_96322796\"><\/div>\n    <\/div>\n  <\/div>\n  \n<\/div><\/div>","date":"27 апреля 2009","tags":[0],"tagged":[],"album":"<a href=\"album-283_92418231\" onclick=\"return nav.go(this, event)\">гитары с одним датчиком<\/a>","author":"<a class=\"mem_link\" href=\"\/id249650\" onclick=\"return nav.go(this, event)\">Александр Александрович<\/a>","likes":0,"actions":{"spam":1,"comm":1,"save":1},"desc":"Fender custom shop","hash":"998b227f3353b9ecb6"},{"id":"-283_128137692","x_src":"http:\/\/cs1536.vkontakte.ru\/u249650\/92418231\/x_64bd77f5.jpg","commcount":"4","commshown":4,"comments":"<div class=\"clear_fix pv_comment \" id=\"pv_comment-283_94527430\"><div>\n  <div class=\"fl_l pv_thumb\">\n    <a href=\"\/id19098635\" onclick=\"return nav.go(this, event)\"><img src=\"http:\/\/cs4569.vkontakte.ru\/u19098635\/e_3d241b10.jpg\" \/><\/a>\n  <\/div>\n  <div class=\"fl_l pv_comm\">\n    <a href=\"\/id19098635\" onclick=\"return nav.go(this, event)\" class=\"name\">Юзик Факин<\/a>\n    <div class=\"pv_commtext\">ммм... charvel...<\/div>\n    <div class=\"pv_commdata\">\n      <span class=\"fl_l\">27 апр 2009 в 13:13<span class=\"sdivide\">|<\/span><a onclick=\"photoview.commAction('spam', '-283_94527430', 'c212d725bd43cda150')\">это спам<\/a><\/span>\n      <div class=\"fl_r progress\" id=\"pv_progress-283_94527430\"><\/div>\n    <\/div>\n  <\/div>\n  \n<\/div><\/div><div class=\"clear_fix pv_comment \" id=\"pv_comment-283_94777400\"><div>\n  <div class=\"fl_l pv_thumb\">\n    <a href=\"\/beerkiller\" onclick=\"return nav.go(this, event)\"><img src=\"http:\/\/cs10953.vkontakte.ru\/u6673348\/e_e1d863de.jpg\" \/><\/a>\n  <\/div>\n  <div class=\"fl_l pv_comm\">\n    <a href=\"\/beerkiller\" onclick=\"return nav.go(this, event)\" class=\"name\">Санёк Пикулин<\/a>\n    <div class=\"pv_commtext\">аля ванхален))<\/div>\n    <div class=\"pv_commdata\">\n      <span class=\"fl_l\">31 мая 2009 в 1:15<span class=\"sdivide\">|<\/span><a onclick=\"photoview.commAction('spam', '-283_94777400', '0b1126747f996fe13a')\">это спам<\/a><\/span>\n      <div class=\"fl_r progress\" id=\"pv_progress-283_94777400\"><\/div>\n    <\/div>\n  <\/div>\n  \n<\/div><\/div><div class=\"clear_fix pv_comment \" id=\"pv_comment-283_96173663\"><div>\n  <div class=\"fl_l pv_thumb\">\n    <a href=\"\/mightymorphin\" onclick=\"return nav.go(this, event)\"><img src=\"http:\/\/cs5932.vkontakte.ru\/u38981429\/e_745f060c.jpg\" \/><\/a>\n  <\/div>\n  <div class=\"fl_l pv_comm\">\n    <a href=\"\/mightymorphin\" onclick=\"return nav.go(this, event)\" class=\"name\">Роман Пискарёв<\/a>\n    <div class=\"pv_commtext\">Юзик X Факин, я бы сказал обконcharvel xD<\/div>\n    <div class=\"pv_commdata\">\n      <span class=\"fl_l\">16 ноя 2009 в 0:25<span class=\"sdivide\">|<\/span><a onclick=\"photoview.commAction('spam', '-283_96173663', 'a10830178fa27fb11f')\">это спам<\/a><\/span>\n      <div class=\"fl_r progress\" id=\"pv_progress-283_96173663\"><\/div>\n    <\/div>\n  <\/div>\n  \n<\/div><\/div><div class=\"clear_fix pv_comment \" id=\"pv_comment-283_100047423\"><div>\n  <div class=\"fl_l pv_thumb\">\n    <a href=\"\/pashka.ocharovashk\" onclick=\"return nav.go(this, event)\"><img src=\"http:\/\/cs5312.vkontakte.ru\/u3532059\/e_1791f98c.jpg\" \/><\/a>\n  <\/div>\n  <div class=\"fl_l pv_comm\">\n    <a href=\"\/pashka.ocharovashk\" onclick=\"return nav.go(this, event)\" class=\"name\">Pashka Ocharovashka<\/a>\n    <div class=\"pv_commtext\">хочу<\/div>\n    <div class=\"pv_commdata\">\n      <span class=\"fl_l\">5 ноя 2010 в 20:34<span class=\"sdivide\">|<\/span><a onclick=\"photoview.commAction('spam', '-283_100047423', '59d352665841f050b4')\">это спам<\/a><\/span>\n      <div class=\"fl_r progress\" id=\"pv_progress-283_100047423\"><\/div>\n    <\/div>\n  <\/div>\n  \n<\/div><\/div>","date":"27 апреля 2009","tags":[0],"tagged":[],"album":"<a href=\"album-283_92418231\" onclick=\"return nav.go(this, event)\">гитары с одним датчиком<\/a>","author":"<a class=\"mem_link\" href=\"\/id249650\" onclick=\"return nav.go(this, event)\">Александр Александрович<\/a>","likes":0,"actions":{"spam":1,"comm":1,"save":1},"desc":"charvel","hash":"6c78ebb582bf34ce1e"},{"id":"-283_128146646","x_src":"http:\/\/cs308.vkontakte.ru\/u15438300\/92418231\/x_0a117dbe.jpg","commcount":"13","commshown":3,"comments":"<div class=\"clear_fix pv_comment \" id=\"pv_comment-283_97024155\"><div>\n  <div class=\"fl_l pv_thumb\">\n    <a href=\"\/the_real_thomson\" onclick=\"return nav.go(this, event)\"><img src=\"http:\/\/cs9564.vkontakte.ru\/u15438300\/e_99b8d8a0.jpg\" \/><\/a>\n  <\/div>\n  <div class=\"fl_l pv_comm\">\n    <a href=\"\/the_real_thomson\" onclick=\"return nav.go(this, event)\" class=\"name\">Саша Тромса<\/a>\n    <div class=\"pv_commtext\">нет.<br><\/div>\n    <div class=\"pv_commdata\">\n      <span class=\"fl_l\">1 фев 2010 в 13:29<span class=\"sdivide\">|<\/span><a onclick=\"photoview.commAction('spam', '-283_97024155', '741c7dc1ee1fe5dbc8')\">это спам<\/a><\/span>\n      <div class=\"fl_r progress\" id=\"pv_progress-283_97024155\"><\/div>\n    <\/div>\n  <\/div>\n  \n<\/div><\/div><div class=\"clear_fix pv_comment \" id=\"pv_comment-283_98525188\"><div>\n  <div class=\"fl_l pv_thumb\">\n    <a href=\"\/id17308398\" onclick=\"return nav.go(this, event)\"><img src=\"http:\/\/cs4121.vkontakte.ru\/u17308398\/e_50697ae8.jpg\" \/><\/a>\n  <\/div>\n  <div class=\"fl_l pv_comm\">\n    <a href=\"\/id17308398\" onclick=\"return nav.go(this, event)\" class=\"name\">Artem Nikolaev<\/a>\n    <div class=\"pv_commtext\">ого ого ого огого гого гогогогого взять &#33;&#33;&#33;&#33;&#33;&#33;&#33;&#33;&#33;&#33;&#33;<\/div>\n    <div class=\"pv_commdata\">\n      <span class=\"fl_l\">18 июн 2010 в 14:55<span class=\"sdivide\">|<\/span><a onclick=\"photoview.commAction('spam', '-283_98525188', '5fb3bc89e30d160ef3')\">это спам<\/a><\/span>\n      <div class=\"fl_r progress\" id=\"pv_progress-283_98525188\"><\/div>\n    <\/div>\n  <\/div>\n  \n<\/div><\/div><div class=\"clear_fix pv_comment \" id=\"pv_comment-283_100925910\"><div>\n  <div class=\"fl_l pv_thumb\">\n    <a href=\"\/id12312987\" onclick=\"return nav.go(this, event)\"><img src=\"http:\/\/cs9810.vkontakte.ru\/u12312987\/e_b25e14ed.jpg\" \/><\/a>\n  <\/div>\n  <div class=\"fl_l pv_comm\">\n    <a href=\"\/id12312987\" onclick=\"return nav.go(this, event)\" class=\"name\">Ma Rk<\/a>\n    <div class=\"pv_commtext\">эскваейр кажется но хамб вместо сингла<\/div>\n    <div class=\"pv_commdata\">\n      <span class=\"fl_l\">13 янв 2011 в 10:46<span class=\"sdivide\">|<\/span><a onclick=\"photoview.commAction('spam', '-283_100925910', 'fc69ddb2debd07019a')\">это спам<\/a><\/span>\n      <div class=\"fl_r progress\" id=\"pv_progress-283_100925910\"><\/div>\n    <\/div>\n  <\/div>\n  \n<\/div><\/div>","date":"27 апреля 2009","tags":[0],"tagged":[],"album":"<a href=\"album-283_92418231\" onclick=\"return nav.go(this, event)\">гитары с одним датчиком<\/a>","author":"<a class=\"mem_link\" href=\"\/the_real_thomson\" onclick=\"return nav.go(this, event)\">Саша Тромса<\/a>","likes":0,"actions":{"spam":1,"comm":1,"save":1},"hash":"e388b7f794fd0a09db"},{"id":"-283_128146647","x_src":"http:\/\/cs308.vkontakte.ru\/u15438300\/92418231\/x_e4e3a856.jpg","commcount":"14","commshown":3,"comments":"<div class=\"clear_fix pv_comment \" id=\"pv_comment-283_97337822\"><div>\n  <div class=\"fl_l pv_thumb\">\n    <a href=\"\/plion\" onclick=\"return nav.go(this, event)\"><img src=\"http:\/\/vkontakte.ru\/images\/question_c.gif\" \/><\/a>\n  <\/div>\n  <div class=\"fl_l pv_comm\">\n    <a href=\"\/plion\" onclick=\"return nav.go(this, event)\" class=\"name\">Руха Плиев<\/a>\n    <div class=\"pv_commtext\">электрогитара FENDER SQUIER AVRIL LAVIGNE TELECASTER<br><br> AVRIL LAVIGNE)) это ее гитара))<br><br><a href=\"\/away.php?to=http%3A%2F%2Fdynatone.ru%2Finfo999006080&h=e4c7b91c7fbfb39a0f\" target=\"_blank\" target=\"_blank\">http:\/\/dynatone.ru\/info999006080<\/a><\/div>\n    <div class=\"pv_commdata\">\n      <span class=\"fl_l\">28 фев 2010 в 8:00<span class=\"sdivide\">|<\/span><a onclick=\"photoview.commAction('spam', '-283_97337822', 'abae7b309441197437')\">это спам<\/a><\/span>\n      <div class=\"fl_r progress\" id=\"pv_progress-283_97337822\"><\/div>\n    <\/div>\n  <\/div>\n  \n<\/div><\/div><div class=\"clear_fix pv_comment \" id=\"pv_comment-283_97459584\"><div>\n  <div class=\"fl_l pv_thumb\">\n    <a href=\"\/the_real_thomson\" onclick=\"return nav.go(this, event)\"><img src=\"http:\/\/cs9564.vkontakte.ru\/u15438300\/e_99b8d8a0.jpg\" \/><\/a>\n  <\/div>\n  <div class=\"fl_l pv_comm\">\n    <a href=\"\/the_real_thomson\" onclick=\"return nav.go(this, event)\" class=\"name\">Саша Тромса<\/a>\n    <div class=\"pv_commtext\">кэп<\/div>\n    <div class=\"pv_commdata\">\n      <span class=\"fl_l\">10 мар 2010 в 16:21<span class=\"sdivide\">|<\/span><a onclick=\"photoview.commAction('spam', '-283_97459584', '1e99727f0f43eccc2f')\">это спам<\/a><\/span>\n      <div class=\"fl_r progress\" id=\"pv_progress-283_97459584\"><\/div>\n    <\/div>\n  <\/div>\n  \n<\/div><\/div><div class=\"clear_fix pv_comment \" id=\"pv_comment-283_101656665\"><div>\n  <div class=\"fl_l pv_thumb\">\n    <a href=\"\/dimakinrus\" onclick=\"return nav.go(this, event)\"><img src=\"http:\/\/cs11228.vkontakte.ru\/u5911124\/e_43b2464f.jpg\" \/><\/a>\n  <\/div>\n  <div class=\"fl_l pv_comm\">\n    <a href=\"\/dimakinrus\" onclick=\"return nav.go(this, event)\" class=\"name\">Дима Акинин<\/a>\n    <div class=\"pv_commtext\">хуита. и гитара, и она<\/div>\n    <div class=\"pv_commdata\">\n      <span class=\"fl_l\">8 мар 2011 в 10:04<span class=\"sdivide\">|<\/span><a onclick=\"photoview.commAction('spam', '-283_101656665', 'fe9de5280ec9daa10a')\">это спам<\/a><\/span>\n      <div class=\"fl_r progress\" id=\"pv_progress-283_101656665\"><\/div>\n    <\/div>\n  <\/div>\n  \n<\/div><\/div>","date":"27 апреля 2009","tags":[0],"tagged":[],"album":"<a href=\"album-283_92418231\" onclick=\"return nav.go(this, event)\">гитары с одним датчиком<\/a>","author":"<a class=\"mem_link\" href=\"\/the_real_thomson\" onclick=\"return nav.go(this, event)\">Саша Тромса<\/a>","likes":0,"actions":{"spam":1,"comm":1,"save":1},"hash":"a362d5c5ffea05195a"}]<!><!json>{"commlimit":2048,"lang":{"reply_to_post":"Комментировать...","wall_more_replies":["","еще %s комментарий","еще %s комментария","еще %s комментариев"],"wall_all_replies":"все комментарии","wall_M_replies_of_N":["","%s комментарий из {link}{all}{\/link}","%s последних комментария из {link}{all}{\/link}","%s последних комментариев из {link}{all}{\/link}"],"photos_X_comms":["","%s комментарий","%s комментария","%s комментариев"],"photos_onthisphoto":"На этой фотографии","photos_yourcomment":"Ваш комментарий","photos_delete_tag":"Удалить отметку","photos_tagperson":"Отметить человека","photos_select_tag_area":"Выделите область, где изображен человек, и он будет подписан на фотографии.","photos_typename":"Введите имя","photos_tags_me":"Я","photos_confirm_tag":"Подтвердить","photos_load_to_profile":"Поместить на мою страницу","photos_in_closed_album":"Эта фотография находится в закрытом альбоме.","photos_edit":"Редактировать","photos_rotate":"Повернуть:","photos_album_name":"Альбом:","photos_author":"Отправитель:","photos_added":"Добавлена","photos_i_like":"Мне нравится","photos_download_hq":"Загрузить оригинал на диск","photos_larger":"Увеличить фотографию","photos_smaller":"Уменьшить фотографию","photos_photo_num_of_N":"Фотография %s из %s","photos_view_one_photo":"Просмотр фотографии","photos_show_prev_comments":["","Показать предыдущий %s комментарий","Показать предыдущие %s комментария","Показать предыдущие %s комментариев"],"photos_edit_desc":"Редактировать описание","photos_edit_desc_intro":"Введите описание","photos_share_from_view":"Поделиться","photos_send_to_fr":"Отправить другу","photos_save_to_alb":"Сохранить к себе в альбом"},"big":"","dark":1,"maxtags":35,"hash":"9ba542bc1f194a6250"}"
//
//
//        q: Object
//al: 1
//offset: 40
//part: 1



add_action('admin_head', 'my_plugin_css');
add_action('admin_head', 'my_plugin_action_javascript');
add_action('admin_menu', 'my_plugin_menu');
add_action('wp_ajax_my_action', 'my_plugin_action_callback');

function cp1251_to_utf8 ($txt)  {
    $in_arr = array (
        chr(208), chr(192), chr(193), chr(194),
        chr(195), chr(196), chr(197), chr(168),
        chr(198), chr(199), chr(200), chr(201),
        chr(202), chr(203), chr(204), chr(205),
        chr(206), chr(207), chr(209), chr(210),
        chr(211), chr(212), chr(213), chr(214),
        chr(215), chr(216), chr(217), chr(218),
        chr(219), chr(220), chr(221), chr(222),
        chr(223), chr(224), chr(225), chr(226),
        chr(227), chr(228), chr(229), chr(184),
        chr(230), chr(231), chr(232), chr(233),
        chr(234), chr(235), chr(236), chr(237),
        chr(238), chr(239), chr(240), chr(241),
        chr(242), chr(243), chr(244), chr(245),
        chr(246), chr(247), chr(248), chr(249),
        chr(250), chr(251), chr(252), chr(253),
        chr(254), chr(255)
    );

    $out_arr = array (
        chr(208).chr(160), chr(208).chr(144), chr(208).chr(145),
        chr(208).chr(146), chr(208).chr(147), chr(208).chr(148),
        chr(208).chr(149), chr(208).chr(129), chr(208).chr(150),
        chr(208).chr(151), chr(208).chr(152), chr(208).chr(153),
        chr(208).chr(154), chr(208).chr(155), chr(208).chr(156),
        chr(208).chr(157), chr(208).chr(158), chr(208).chr(159),
        chr(208).chr(161), chr(208).chr(162), chr(208).chr(163),
        chr(208).chr(164), chr(208).chr(165), chr(208).chr(166),
        chr(208).chr(167), chr(208).chr(168), chr(208).chr(169),
        chr(208).chr(170), chr(208).chr(171), chr(208).chr(172),
        chr(208).chr(173), chr(208).chr(174), chr(208).chr(175),
        chr(208).chr(176), chr(208).chr(177), chr(208).chr(178),
        chr(208).chr(179), chr(208).chr(180), chr(208).chr(181),
        chr(209).chr(145), chr(208).chr(182), chr(208).chr(183),
        chr(208).chr(184), chr(208).chr(185), chr(208).chr(186),
        chr(208).chr(187), chr(208).chr(188), chr(208).chr(189),
        chr(208).chr(190), chr(208).chr(191), chr(209).chr(128),
        chr(209).chr(129), chr(209).chr(130), chr(209).chr(131),
        chr(209).chr(132), chr(209).chr(133), chr(209).chr(134),
        chr(209).chr(135), chr(209).chr(136), chr(209).chr(137),
        chr(209).chr(138), chr(209).chr(139), chr(209).chr(140),
        chr(209).chr(141), chr(209).chr(142), chr(209).chr(143)
    );

    $txt = str_replace($in_arr,$out_arr,$txt);
    return $txt;
}

function my_plugin_menu() {
//	add_options_page('ProjectOne Options', 'ProjectOne', 'manage_options', 'project-one', 'my_plugin_options');
    add_menu_page('ProjectOne Plugin', 'ProjectOne', 'manage_options', 'project-one', 'my_plugin_options');
//    add_submenu_page('project-one', 'ProjectOne Help', 'Help', 'manage_options', 'project-one-help', 'my_plugin_help');
}

function my_plugin_css() {
?>
    <style type="text/css">
        #ajax-container {
            margin-top: 10px;
        }
        #listIdForm label {
            padding-right: 10px;
        }
        .ajax-loading-gif {
            width: 16px;
            height: 23px;
            background: white url(images/loading.gif) no-repeat center;
            display: none;
        }
    </style>
<?php
}

function my_plugin_action_javascript() {
?>
    <script type="text/javascript">
        jQuery(document).ready(function($) {
            var data = {
                action: 'my_action'
            };
            $("#listIdForm").submit(function() {
                data.listId = $("#listId").val();
                data.offset = $("#offset").val();
                $("#listIdFormLoader").fadeIn();
                $("#go-btn").val('Пошло-поехало! Ждём...');
                jQuery.post(ajaxurl, data, function(json) {
                    try{
                        var response = jQuery.parseJSON(json);
                    } catch(e) {
                        $("#go-btn").val('JSON не парсится :(');
                        $("#listIdFormLoader").fadeOut();
                        alert('Parsing error: ' + e.name)
                        alert(json);
                    }

                    if (response['listId'] == 0) {
                        $("#go-btn").val('Хм, сам траблез :/');
                        $("#listIdFormLoader").fadeOut();
                        $("#ajax-container").empty();
                        $("#ajax-container").html('<pre style="color: #ff6347;">' + response['listData'] + '</pre>');
                    } else {
                        var listData = jQuery.parseJSON(response['listData']);
                        $("#go-btn").val('Ура! Пришло!');
                        $("#listIdFormLoader").fadeOut();
                        $("#listSize").html(response['listSize']);
                        $("#ajax-container").empty();
                        $("#ajax-container").append('<table class="widefat"></table>');
                        $("#ajax-container table").append('<thead><tr><th>#</th><th>Id</th><th>x_src</th><th>Album</th></tr></thead>');
                        $("#ajax-container table").append('<tfoot><tr><th>#</th><th>Id</th><th>x_src</th><th>Album</th></tr></tfoot>');
                        $("#ajax-container table").append('<tbody></tbody>');
                        for (var i = 0; i < 10; i++) {
                            $("#ajax-container table tbody").append('<tr><th>'+(i+parseInt($("#offset").val())+1)+'</th><th>'+listData[i].id+'</th><th>'+listData[i].x_src+'</th><th>'+listData[i].album+'</th></tr>');
                        };
                    };
                });
                return false;
            });
        });
    </script>
<?php
}

function my_plugin_options() {
	if (!current_user_can('manage_options'))  {
		wp_die( __('You do not have sufficient permissions to access this page.') );
	}
	echo '<div class="wrap">';
	echo '<p style="float: right;">Ещё чуть-чуть и прямо в рай, и жизнь удалась.</p>';
	echo '<div>';
?>
        <form id="listIdForm">
            <ul>
                <li><label for="listId">Идентификатор альбома<span>*</span>: </label>
                <input id="listId" size="30" name="listId" value="album-2281699_140017490" /></li>
                <li><label for="offset">Смещение: </label>
                <input id="offset" name="offset" value="0" /> (всего <span id="listSize">хз</span> фото)</li>
                <li><div><input type="submit" value="Го!" id="go-btn" class="button-secondary" style="float: left; width: 150px;" />
                <div class="ajax-loading-gif" id="listIdFormLoader" style="float: left; padding-left: 3px"></div></div></li>
            </ul>
        </form>
<?php
    echo '</div><br><br>';
    echo '<div id="ajax-container"></div>';
    echo '</div>';
}

function my_plugin_action_callback() {
    $absinthe = absinthe($_POST['listId'], $_POST['offset']);

    preg_match_all('/\<![a-z]*\>(.*?)\<!\>/', $absinthe, $matches);

    if (!empty($matches[1][0])) {
        $jsonResponse = array('listId' => $matches[1][2],
                              'listSize' => $matches[1][3],
                              'listData' => cp1251_to_utf8($matches[1][5]));
    } else {
        $jsonResponse = array('listId' => 0,
                              'listData' => 'We`ve got some troubles');
    }

    echo json_encode($jsonResponse);
	die();
}

function absinthe($listId, $offset) {
    $postvars = array(
      "act" => "show",
      "al"  => "1",
      "list" => $listId,
      "offset" => $offset,
      "direction" => null
    );

    $postdata = "";
    foreach ( $postvars as $key => $value )
        $postdata .= "&".rawurlencode($key)."=".rawurlencode($value);
    $postdata = substr( $postdata, 1 );

    $ch = curl_init();
    curl_setopt ($ch, CURLOPT_URL, "http://vk.com/al_photos.php");
    curl_setopt ($ch, CURLOPT_USERAGENT, "Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.8.1.6) Gecko/20070725 Firefox/2.0.0.6");
    curl_setopt ($ch, CURLOPT_TIMEOUT, 60);
    curl_setopt ($ch, CURLOPT_POSTFIELDS, $postdata);
//    curl_setopt ($ch, CURLOPT_FOLLOWLOCATION, 1);
    curl_setopt ($ch, CURLOPT_RETURNTRANSFER, 1);
    $result = curl_exec ($ch);
    curl_close($ch);

    return $result;
}

//function my_plugin_help() {
//	if (!current_user_can('manage_options'))  {
//		wp_die( __('You do not have sufficient permissions to access this page.') );
//	}
//
//    echo 'AAAAAAAAAAA!!!';
//}
?>